---
title: "STAA57 project Graphs"
author: "Divy Wadhwani - 1011361544"
date: "2025-04-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
```

# Graphs

## Graph 1 : Progression of Cases by Age Group

Data used can be found [here](https://data.ontario.ca/dataset/ontario-covid-19-testing-percent-positive-by-age-group/resource/05214a0d-d8d9-4ea4-8d2a-f6e3833ba471).

```{r, echo = FALSE}
data = read.csv("~/05214a0d-d8d9-4ea4-8d2a-f6e3833ba471.csv")
ggplot(data, aes(x = X_id, y = percent_positive_7d_avg, color = age_category)) +
  geom_line(size = 1) +
  labs(
    title = "7-Day Average Positivity Rate by Age Group",
    x = "Sequential X_id",
    y = "Percent Positive (7-day avg)",
    color = "Age Group"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),      # hide x-axis tick labels
    axis.ticks.x = element_blank(),     # hide x-axis tick marks
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```

### Observations

The plot illustrates the 7-day average COVID-19 test positivity rates across different age groups over a series of days, using sequential ind ices on the x-axis. Each age group displays distinct trends, with earlier and more volatile spikes in younger groups (0–24) and a more gradual but sustained rise in older populations, particularly those 65 and above. This staggered pattern suggests that infections may have initially spread through younger, more socially active cohorts before affecting older, more vulnerable groups. While the use of X_id simplifies the timeline, it limits precise temporal analysis.

## Graph 2 :

Data used can be found [here](https://data.ontario.ca/dataset/covid-19-vaccine-data-in-ontario/resource/775ca815-5028-4e9b-9dd4-6975ff1be021).

```{r, echo = FALSE, figure.width=10000}
df = read.csv("~/775ca815-5028-4e9b-9dd4-6975ff1be021.csv")
# Create cleaner labels
df_long$Vaccination_Status <- recode(
  df_long$Vaccination_Status,
  "Percent_at_least_one_dose" = "At Least One Dose",
  "Percent_fully_vaccinated" = "Fully Vaccinated",
  "Percent_3doses" = "Three Doses"
)

# Plot with better spacing and facet labels
ggplot(df_long, aes(x = Date, y = Percent, color = Agegroup)) +
  geom_line(size = 1) +
  facet_wrap(~Vaccination_Status, scales = "free_y") +
  labs(
    title = "COVID-19 Vaccination Coverage by Age Group",
    x = "Date",
    y = "Percent of Population Vaccinated",
    color = "Age Group"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    legend.title = element_text(size = 12),
  )


```

### Observations

The plot displays the progression of COVID-19 vaccination coverage by age group in Ontario across three categories: at least one dose, fully vaccinated, and three doses. Vaccination uptake was fastest and most comprehensive among older adults (particularly ages 60–79 and 80+), reaching nearly 100% in all three categories. In contrast, younger groups such as 5–11 and 12–17 years showed slower and lower coverage, especially for the third dose, which plateaued well below 30% and 20%, respectively. Broad population groups like "Ontario_12plus" and "Adults_18plus" also achieved high uptake, while the "Undisclosed_or_missing" category remained flat at 0%. The trends reflect age-based rollout strategies and varying levels of vaccine eligibility and uptake over time.

## Graph 3 : Hospital & ICU Trends Over Time

The data used can be found [here](https://data.ontario.ca/dataset/breakdown-of-covid-19-positive-hospital-admissions/resource/d1199d1b-dc82-4e63-bb80-5c715e97a127)

```{r, echo = FALSE, figure.width = 10000000}
hosp_df = read.csv("~/d1199d1b-dc82-4e63-bb80-5c715e97a127.csv")
hosp_df = hosp_df %>% select(-X_id)

# Convert date and numeric columns
hosp_df <- hosp_df %>%
  mutate(
    date = as.Date(date),
    across(c(hosp_for_covid, hosp_other_conditions, icu_for_covid, icu_other_conditions), as.numeric)
  )

# Pivot to long format
hosp_long <- hosp_df %>%
  pivot_longer(
    cols = -date,
    names_to = "Category",
    values_to = "Count"
  )

hosp_long$Category <- recode(hosp_long$Category,
  "hosp_for_covid" = "Hospitalized for COVID",
  "hosp_other_conditions" = "Hospitalized for Other Conditions",
  "icu_for_covid" = "ICU for COVID",
  "icu_other_conditions" = "ICU for Other Conditions"
)

# Plot
ggplot(hosp_long, aes(x = date, y = Count, color = Category)) +
  geom_point(size = 0.4) +
  labs(
    title = "Hospital Admissions Over Time during the pandemic",
    x = "Date",
    y = "Proportion of Patients",
    color = "Admission Type"
  ) +
  theme_minimal() +
  theme(
    legend.position = "left"
  )

```

### Observations

This plot illustrates the changing proportions of hospital and ICU admissions for COVID-19 and other conditions over the course of the pandemic. ICU admissions for COVID consistently represented a high proportion of total admissions, particularly in early 2022, before gradually declining with fluctuations over time. In contrast, hospitalizations for non-COVID conditions showed a steady upward trend, eventually surpassing COVID-related hospitalizations in relative frequency. ICU admissions for other conditions remained comparatively lower throughout, but displayed noticeable variation. Overall, the data suggests a gradual shift from COVID-dominant hospitalizations to a more balanced or non-COVID-dominant healthcare burden as the pandemic evolved.

## Appendix

```{r, eval = FALSE}
# Code for graph 1
data = read.csv("~/05214a0d-d8d9-4ea4-8d2a-f6e3833ba471.csv")
ggplot(data, aes(x = X_id, y = percent_positive_7d_avg, color = age_category)) +
  geom_line(size = 1) +
  labs(
    title = "7-Day Average Positivity Rate by Age Group",
    x = "Sequential X_id",
    y = "Percent Positive (7-day avg)",
    color = "Age Group"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),      # hide x-axis tick labels
    axis.ticks.x = element_blank(),     # hide x-axis tick marks
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
# Code for graph 2
df = read.csv("~/775ca815-5028-4e9b-9dd4-6975ff1be021.csv")
# Create cleaner labels
df_long$Vaccination_Status <- recode(
  df_long$Vaccination_Status,
  "Percent_at_least_one_dose" = "At Least One Dose",
  "Percent_fully_vaccinated" = "Fully Vaccinated",
  "Percent_3doses" = "Three Doses"
)

# Plot with better spacing and facet labels
ggplot(df_long, aes(x = Date, y = Percent, color = Agegroup)) +
  geom_line(size = 1) +
  facet_wrap(~Vaccination_Status, scales = "free_y") +
  labs(
    title = "COVID-19 Vaccination Coverage by Age Group",
    x = "Date",
    y = "Percent of Population Vaccinated",
    color = "Age Group"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    legend.title = element_text(size = 12),
  )
# Code for graph 3
hosp_df = read.csv("~/d1199d1b-dc82-4e63-bb80-5c715e97a127.csv")
hosp_df = hosp_df %>% select(-X_id)

# Convert date and numeric columns
hosp_df <- hosp_df %>%
  mutate(
    date = as.Date(date),
    across(c(hosp_for_covid, hosp_other_conditions, icu_for_covid, icu_other_conditions), as.numeric)
  )

# Pivot to long format
hosp_long <- hosp_df %>%
  pivot_longer(
    cols = -date,
    names_to = "Category",
    values_to = "Count"
  )

hosp_long$Category <- recode(hosp_long$Category,
  "hosp_for_covid" = "Hospitalized for COVID",
  "hosp_other_conditions" = "Hospitalized for Other Conditions",
  "icu_for_covid" = "ICU for COVID",
  "icu_other_conditions" = "ICU for Other Conditions"
)

# Plot
ggplot(hosp_long, aes(x = date, y = Count, color = Category)) +
  geom_point(size = 0.4) +
  labs(
    title = "Hospital Admissions Over Time during the pandemic",
    x = "Date",
    y = "Proportion of Patients",
    color = "Admission Type"
  ) +
  theme_minimal() +
  theme(
    legend.position = "left"
  )

```
